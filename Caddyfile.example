# Single host; path-based routing; Tailscale certs mounted by Docker at /etc/certs
{$TS_NODE} {
  # Use the Tailscale-issued certs generated by `tailscale cert`
  tls /etc/certs/{$TS_NODE}.crt /etc/certs/{$TS_NODE}.key

  # Immich under /immich
  handle_path /immich/* {
    uri strip_prefix /immich
    reverse_proxy {$IMMICH_UPSTREAM}
  }

  # PhotoPrism under /prism
  handle_path /prism/* {
    uri strip_prefix /prism
    reverse_proxy {$PHOTOPRISM_UPSTREAM}
  }

  @root path /
  handle @root {
    respond "OK: try /immich or /prism" 200
  }
}
